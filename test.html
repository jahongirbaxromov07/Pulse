<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Anatomiya Testlari</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .answer-btn {
            transition: all .2s ease;
        }

        .answer-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>

<body class="bg-light">

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2 fw-semibold" href="index.html">
                <img src="Pulse.jpg" width="40" height="40" class="rounded-circle">
                Pulse Medical
            </a>
            <a href="index.html" class="btn btn-light btn-sm">
                <i class="bi bi-house"></i> Bosh sahifa
            </a>
        </div>
    </nav>

    <!-- TEST SELECTION -->
    <section id="test-selection" class="py-5 bg-light">
        <div class="container">

            <div class="text-center mb-4">
                <span class="badge bg-primary-subtle text-primary px-3 py-2 mb-2">
                    <i class="bi bi-journal-text"></i> Testlar
                </span>
                <h2 class="fw-bold">Anatomiya Testlari</h2>
                <p class="text-muted">Bilimingizni mustahkamlang</p>
            </div>

            <div class="accordion shadow-sm" id="anatomyAccordion">

                <!-- ANATOMY HEADER -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse"
                            data-bs-target="#anatomyTests" aria-expanded="true">
                            <i class="bi bi-heart-pulse me-2 text-danger"></i> Anatomiya
                        </button>
                    </h2>

                    <!-- OPENED BY DEFAULT -->
                    <div id="anatomyTests" class="accordion-collapse collapse show">
                        <div class="accordion-body">

                            <!-- FIRST 2 TESTS (VISIBLE) -->
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">Suyaklar</h5>
                                            <button onclick="startTest('test1')" class="btn btn-success w-100">
                                                Boshlash
                                            </button>
                                            <small class="text-muted d-block mt-2">
                                                <i class="bi bi-eye"></i>
                                                <span id="view-test1">0</span> marta yechildi
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">Bo'g'imlar</h5>
                                            <button onclick="startTest('test2')" class="btn btn-success w-100">
                                                Boshlash
                                            </button>
                                            <small class="text-muted d-block mt-2">
                                                <i class="bi bi-eye"></i>
                                                <span id="view-test2">0</span> marta yechildi
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- MORE TESTS (COLLAPSE) -->
                            <div class="collapse" id="moreTests">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card h-100 border-0 shadow-sm">
                                            <div class="card-body text-center">
                                                <h5 class="card-title">Mushaklar</h5>
                                                <button onclick="startTest('super')"
                                                    class="btn btn-warning text-white w-100">
                                                    Super Boshlash
                                                </button>
                                                <small class="text-muted d-block mt-2">
                                                    <i class="bi bi-eye"></i>
                                                    <span id="view-super">0</span> marta yechildi
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SHOW MORE BUTTON -->
                            <div class="text-center mt-4">
                                <button class="btn btn-outline-primary" data-bs-toggle="collapse"
                                    data-bs-target="#moreTests">
                                    <i class="bi bi-chevron-down"></i> Ko‚Äòproq ko‚Äòrsatish
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

        </div>
    </section>


    <!-- TEST SCREEN -->
    <section class="pb-5">
        <div class="container">
            <div id="test-screen" class="card shadow-lg border-0 mx-auto d-none" style="max-width: 700px;">
                <div class="card-body p-4 position-relative">

                    <!-- STOP -->
                    <button onclick="stopTest()" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-6">
                        <i class="bi bi-x-lg"></i>
                    </button>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 id="test-title" class="fw-bold mb-0"></h5>
                        <span id="timer" class="badge bg-secondary fs-6"></span>
                    </div>

                    <p id="question-container" class="fs-5 fw-medium mb-4"></p>

                    <div id="answer-buttons" class="d-grid gap-3"></div>

                    <div id="result" class="alert alert-success text-center fw-bold fs-5 mt-4 d-none">
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="questions.js"></script>

    <script>
        function shuffle(array) {
            return [...array]
                .map(value => ({ value, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value);
        }

        function randomizeTest(questions) {
            return shuffle(questions).map(question => {
                const shuffledAnswers = shuffle(question.a);

                return {
                    q: question.q,
                    a: shuffledAnswers,
                    correct: shuffledAnswers.indexOf(
                        question.a[question.correct]
                    )
                };
            });
        }


        const tests = {
            test1: randomizeTest(TEST_QUESTIONS.test1),
            test2: randomizeTest(TEST_QUESTIONS.test2),
            super: randomizeTest(TEST_QUESTIONS.super)
        };



        function updateViews(testName) {
            let views = localStorage.getItem(`views_${testName}`);
            views = views ? parseInt(views) + 1 : 1;
            localStorage.setItem(`views_${testName}`, views);
            document.getElementById(`view-${testName}`).innerText = views;
        }

        function loadViews() {
            ['test1', 'test2', 'super'].forEach(test => {
                const views = localStorage.getItem(`views_${test}`) || 0;
                document.getElementById(`view-${test}`).innerText = views;
            });
        }

        function getTest(testName) {
            return randomizeTest(TEST_QUESTIONS[testName]);
        }


        function startTest(testName) {
            updateViews(testName); // üëÅ view +1

            currentTest = getTest[testName];
            currentIndex = 0;
            score = 0;

            document.getElementById('test-selection').classList.add('d-none');
            document.getElementById('test-screen').classList.remove('d-none');
            document.getElementById('result').classList.add('d-none');

            showQuestion();
        }

        window.onload = loadViews;


        let currentTest = [];
        let currentIndex = 0;
        let score = 0;
        let timer;
        let timeLeft = 25;


        function showQuestion() {
            if (currentIndex >= currentTest.length) {
                document.getElementById('result').innerText =
                    `Natija: ${score} / ${currentTest.length}`;
                document.getElementById('result').classList.remove('d-none');
                return;
            }

            const q = currentTest[currentIndex];
            document.getElementById('test-title').innerText =
                `Savol ${currentIndex + 1}`;
            document.getElementById('question-container').innerText = q.q;

            const answerButtons = document.getElementById('answer-buttons');
            answerButtons.innerHTML = '';

            q.a.forEach((ans, index) => {
                const btn = document.createElement('button');
                btn.innerHTML = `<i class="bi bi-circle"></i> ${ans}`;
                btn.className = 'btn btn-outline-primary btn-lg text-start answer-btn';
                btn.onclick = () => selectAnswer(index);
                answerButtons.appendChild(btn);
            });

            clearInterval(timer);
            timeLeft = 20;
            document.getElementById('timer').innerText = `‚è± ${timeLeft}s`;

            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = `‚è± ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    selectAnswer(-1);
                }
            }, 1000);
        }

        function selectAnswer(selectedIndex) {
            clearInterval(timer);

            const buttons = document.querySelectorAll('#answer-buttons button');
            const correctIndex = currentTest[currentIndex].correct;

            // Barcha tugmalarni disable qilish
            buttons.forEach(btn => btn.disabled = true);

            // To'g'ri javobni yashil qilish (yumshoq)
            buttons[correctIndex].classList.remove('btn-outline-primary');
            buttons[correctIndex].classList.add('btn-success');
            buttons[correctIndex].style.transition = "background-color 0.3s, color 0.3s";

            // Agar noto'g'ri bosilgan bo'lsa ‚Äì yumshoq qizil
            if (selectedIndex !== correctIndex && selectedIndex !== -1) {
                buttons[selectedIndex].classList.remove('btn-outline-primary');
                buttons[selectedIndex].classList.add('btn-danger');
                buttons[selectedIndex].style.transition = "background-color 0.3s, color 0.3s";
            }

            // Ball hisoblash
            if (selectedIndex === correctIndex) score++;

            // Keyingi savolga 1 soniya kutib o'tish
            setTimeout(() => {
                currentIndex++;
                showQuestion();
            }, 1000);
        }



        function stopTest() {
            if (confirm("Rostdan testni tugatmoqchimisiz?")) {
                clearInterval(timer);
                document.getElementById('test-screen').classList.add('d-none');
                document.getElementById('test-selection').classList.remove('d-none');
            }
        }

        // Testni bosganingizda view +1 qilish
        function updateGlobalViews(testName) {
            const ref = db.ref(`views/${testName}`);

            // Transaction bilan +1
            ref.transaction(current => (current || 0) + 1);

            // Real-time ko‚Äòrsatish
            ref.on('value', snapshot => {
                document.getElementById(`view-${testName}`).innerText = snapshot.val() || 0;
            });
        }

        // Sahifa yuklanganda barcha viewlarni real-time ko‚Äòrsatish
        ['test1', 'test2', 'super'].forEach(test => updateGlobalViews(test));

        function startTest(testName) {
            // Global view +1
            const ref = db.ref(`views/${testName}`);
            ref.transaction(current => (current || 0) + 1);

            // Testni boshlash
            currentTest = tests[testName];
            currentIndex = 0;
            score = 0;

            document.getElementById('test-selection').classList.add('d-none');
            document.getElementById('test-screen').classList.remove('d-none');
            document.getElementById('result').classList.add('d-none');

            showQuestion();
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase App -->
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>

        // Firebase konfiguratsiyasi
        const firebaseConfig = {
            apiKey: "AIzaSyCCqvgW8yTfmTHglz3siSLfLJo6NjXd_ws",
            authDomain: "pulse-5f61d.firebaseapp.com",
            databaseURL: "https://pulse-5f61d-default-rtdb.firebaseio.com",
            projectId: "pulse-5f61d",
            storageBucket: "pulse-5f61d.firebasestorage.app",
            messagingSenderId: "359964012652",
            appId: "1:359964012652:web:10722fdfb19d41a1052849",
            measurementId: "G-QX686G4TT9"
        };

        // Firebase initialize
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Global view funksiyasi
        function updateGlobalViews(testName) {
            const ref = db.ref(`views/${testName}`);
            ref.transaction(current => (current || 0) + 0);
            ref.on('value', snapshot => {
                document.getElementById(`view-${testName}`).innerText = snapshot.val() || 0;
            });
        }

        ['test1', 'test2', 'super'].forEach(test => updateGlobalViews(test));
    </script>

</body>

</html>
